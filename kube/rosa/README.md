# ROSA (Red Hat OpenShift Service on AWS)
This pipeline creates / deletes a ROSA cluster to be used by the OpenShift autonomous deployment pipelines.

## Configuration of Jenkins Job

### Target Agent

Since this pipeline creates infrastructure, it will run on the `build_infra` agents.

### Parameters

See the `parameters.yaml` for all available parameters.  Particularly the following:
- `CLUSTER_MANAGER_MODE`
- `CLUSTER_VERSION`
- `CLUSTER_NAME`
- `RESOURCE_TAG_OWNER`
- `DX_PRIVATE_HOSTED_ZONE`
- `DX_PUBLIC_HOSTED_ZONE`

Before destroying the cluster, make sure it is not used by anyone/anything else.

`CLUSTER_MANAGER_MODE`, `CLUSTER_VERSION` and `CLUSTER_NAME` can be overidden when starting the job.  If empty, the default in `parameters.yaml` will be used.

Note: this pipeline assumes the Route53 DX private and public hosted zones are already setup prior to running the job.  It uses `dx-cluster-dev.hcl-dx-dev.net` (private) and `hcl-dx-dev.net` (public) as default which is the ROSA cluster used for the OpenShift autonomous deployment pipelines.

### Credentials Used

The credentials `openshift_rosa_api_token` is the ROSA CLI token for the cluster owner (obtained via https://console.redhat.com/openshift/token/rosa/show, Red Hat account required).  The current token is generated by the functional account `cnx_rhel`.

The Jenkins credentials `openshift_rosa_credentials` is used as the admin user of the ROSA cluster to be created.

Once it is setup, the cluster will be shown in https://console.redhat.com/openshift/  (need access to the `cnx_rhel` account or an account with the same org to see it).  Cluster console URL can be found in the `Networking` tab in the console.

### Pipeline definition configuration

Configure the Job to use a `Pipeline script from SCM` with the target SCM being `Git`. Use the repository URL `git@git.cwp.pnp-hcl.com:Team-Q/Portal-Test-Automation.git` and a fitting git credential, e.g. `git-ssh-access-key`.

As Branch, specify what you need, default would be `develop`.

For the `Script Path` use `kube/rosa/deploy.gvy`
